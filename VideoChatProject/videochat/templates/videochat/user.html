{% extends 'base.html' %}

{% block title %} Perfil de {{ user.username }} {% endblock %}
	
{% block body_block %}
    {% load static %}

	<div class="container">
        <div id="heading-breadcrumbs">
            <div class="container">
                <div class="row">
                    <div class="col-md-3">
                        <img style="height: 150px; width: 150px;" src="{% static "img/person-1.jpg" %}" alt="" class="img-responsive">
                    </div>
                    <div class="col-md-6">
                        <div class="heading text-center">
                            <h2>{{ user.username }}</h2>
                        </div>
                        <p class="lead text-center">User since {{ user.date_joined }}</p>
                    </div>

                </div>
            </div>
        </div>

        <div class="tabs">
        <ul class="nav nav-pills nav-justified">
            <li class="active"><a href="#tab2-1" data-toggle="tab">Personal information</a>
            </li>
             <li class=""><a href="#tab2-2" data-toggle="tab">Friend requests</a>
            </li>
            <li class=""><a href="#tab2-3" data-toggle="tab">Friends</a>
            </li>
            <li class=""><a href="#tab2-4" data-toggle="tab">Uploaded videos</a>
            </li>

        </ul>

        <script>
                function handle_request(request_accepted, pk, username) {

                    var accept_button = document.getElementById(pk); // pk is accept button's id
                    var reject_button = document.getElementById(username); // username is reject button's id

                    var acceptClasses = accept_button.classList;
                    var rejectClasses = reject_button.classList;

                    handle_request_ajax(request_accepted, pk);

                    if (request_accepted) {
                        accept_button.innerHTML = "Accepted";
                        acceptClasses.remove('btn-success');
                        acceptClasses.add('btn-default');

                        $(accept_button).prop('disabled', true);
                        $(reject_button).hide();

                        accept_button.blur();
                    } else {
                        reject_button.innerHTML = "Rejected";
                        rejectClasses.remove('btn-danger');
                        rejectClasses.add('btn-default');

                        $(reject_button).prop('disabled', true);
                        $(accept_button).hide();

                        reject_button.blur();
                    }
                }

                function handle_request_ajax(result, pk){
                    console.log('Handle friend request');
                    $.ajax({
                        type: "POST",
                        url: "/vc/ajax/handle_request/",
                        dataType: "json",
                        data: { "to_user":{{ user.pk }}, "from_user":pk, "result":result},
                        success: function(data) {
                            console.log(data.message);
                        }
                    });
                }

                </script>

        <div class="tab-content tab-content-inverse">
            <div class="tab-pane active" id="tab2-1">
                <h4>First name:</h4> {{ user.first_name }}
                <h4>Last name:</h4> {{ user.last_name}}
                <h4>Email account:</h4> {{ user.email}}
            </div>
            <!-- /.tab -->
            <div class="tab-pane" id="tab2-2">
                <div class="center container">
                    <table>
                        {% for frequest in friend_requests %}
                            <tr>
                                <td class="col-md-8"><a href="{% url 'videochat:u' frequest.from_user.pk %}">{{ frequest.from_user.username }}</a></td>


                                <td class="col-md-3">
                                    <button id="{{ frequest.from_user.pk }}"
                                            onclick="handle_request(true ,{{ frequest.from_user.pk }}, '{{ frequest.from_user.username }}')"
                                            type="button" class="btn btn-lg btn-success">Accept
                                    </button>
                                    <button id="{{ frequest.from_user.username }}"
                                            onclick="handle_request(false ,{{ frequest.from_user.pk }}, '{{ frequest.from_user.username }}')"
                                            type="button" class="btn btn-lg btn-danger">Reject
                                    </button>
                                </td>
                            </tr>
                         {% empty %}
                            <p>You don't have friend requests.</p>
                        {% endfor %}
                    </table>
                </div>
            </div>
            <!-- /.tab -->
            <div class="tab-pane" id="tab2-3">
                {% for friend in friends %}
                    <ul>
                        <li>{{ friend }} </li>
                    </ul>
                {% empty %}
                    <p>You don't have friends.</p>
                {% endfor %}
            </div>
            <!-- /.tab -->
            <div class="tab-pane" id="tab2-4">
                {% for friend in friends %}
                    <ul>
                        <li>{{ frequest.user }} </li>
                    </ul>
                {% empty %}
                    <p>You don't have friends.</p>
                {% endfor %}
            </div>
        </div>
    </div>
	</div>
{% endblock %}